<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='UTF-8'/>
<meta name='viewport' content='width=device-width, initial-scale=1.0'/>
<title>TryLab – Profit Potential Calculator (v3)</title>
<script src='https://cdn.tailwindcss.com'></script>
<script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js'></script>
<link href='https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap' rel='stylesheet'>
<style>
:root{--cobalt:#0038FF;--sky:#97CDFF;--sand:#EF9362;--ink:#0B0F19;--stone:#EAF0F6;--slate:#667085}
html,body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
.brand-gradient{background:radial-gradient(1200px 600px at 10% -10%, rgba(0,56,255,.25), transparent 60%),radial-gradient(1200px 600px at 110% 10%, rgba(151,205,255,.25), transparent 50%),linear-gradient(180deg,#fff,#f8fafc)}
.card{border-radius:1.25rem;box-shadow:0 10px 30px rgba(2,8,23,.06);border:1px solid rgba(2,8,23,.06)}
.btn{border-radius:12px;padding:.65rem 1rem;font-weight:600}
.btn-ghost{background:transparent;color:var(--cobalt);border:1px solid rgba(0,56,255,.22)}
</style>
</head>
<body class='min-h-screen brand-gradient text-[15px] text-gray-900'>
<header class='sticky top-0 z-30 bg-white/70 backdrop-blur border-b border-black/5'>
  <div class='max-w-7xl mx-auto px-5 py-3 flex items-center gap-3'>
    <div class='w-9 h-9 rounded-xl bg-gradient-to-tr from-[var(--cobalt)] to-[var(--sky)] grid place-items-center text-white font-extrabold'>TL</div>
    <div class='flex-1'>
      <h1 class='text-base font-semibold'>TryLab ROI Simulator</h1>
      <p class='text-xs text-slate-500'>Plan profit like a pro — no spreadsheet chaos.</p>
    </div>
    <button id='saveBtn' class='btn btn-ghost hidden sm:inline-flex'>
      <svg xmlns='http://www.w3.org/2000/svg' class='w-4 h-4 mr-2' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4'/><polyline points='7 10 12 15 17 10'/><line x1='12' y1='15' x2='12' y2='3'/></svg>
      Export PDF
    </button>
  </div>
</header>

<main id='captureArea' class='max-w-7xl mx-auto px-5 py-6 space-y-6'>
  <!-- Intro -->
  <section class='card p-6'>
    <div class='grid md:grid-cols-2 gap-6 items-center'>
      <div>
        <h2 class='text-2xl md:text-3xl font-extrabold tracking-tight'>Profit Potential Calculator</h2>
        <p class='mt-2 text-slate-600'>Model how tweaks to <b>traffic</b>, <b>conversion</b>, and <b>AOV</b> flow through to revenue and contribution profit.</p>
      </div>
      <div class='rounded-2xl p-4 bg-gradient-to-tr from-white to-slate-50 border border-black/5'>
        <div class='grid grid-cols-2 gap-3'>
          <div class='p-3 rounded-xl bg-white'>
            <div class='text-[11px] uppercase tracking-wide text-slate-500'>Scenario Δ vs Base</div>
            <div class='text-lg font-bold' id='heroDeltaProfit'>$0</div>
          </div>
          <div class='p-3 rounded-xl bg-white'>
            <div class='text-[11px] uppercase tracking-wide text-slate-500'>Projected Orders</div>
            <div class='text-lg font-bold' id='heroOrders'>0</div>
          </div>
        </div>
        <p class='text-[12px] text-slate-500 mt-2'>Live preview reflects your inputs below.</p>
      </div>
    </div>
  </section>

  <div class='grid grid-cols-1 xl:grid-cols-3 gap-6'>
    <!-- Inputs -->
    <section class='card p-6'>
      <h3 class='text-lg font-semibold'>1) Current Store Inputs</h3>
      <div class='mt-4 grid grid-cols-1 gap-4'>
        <label class='block'>
          <span class='text-sm text-slate-500'>Monthly Sessions</span>
          <input id='sessions' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 focus:ring-2 focus:ring-[var(--cobalt)]' value='50000' min='0' step='100' />
        </label>
        <div class='grid grid-cols-2 gap-4'>
          <label class='block'>
            <span class='text-sm text-slate-500'>CVR %</span>
            <input id='cvr' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 focus:ring-2 focus:ring-[var(--cobalt)]' value='2.5' min='0' step='0.1' />
          </label>
          <label class='block'>
            <span class='text-sm text-slate-500'>AOV ($)</span>
            <input id='aov' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 focus:ring-2 focus:ring-[var(--cobalt)]' value='75' min='0' step='1' />
          </label>
        </div>
        <div class='grid grid-cols-2 gap-4'>
          <label class='block'>
            <span class='text-sm text-slate-500'>Gross Margin %</span>
            <input id='gm' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2' value='60' min='0' step='1' />
          </label>
          <label class='block'>
            <span class='text-sm text-slate-500'>Refund Rate %</span>
            <input id='refund' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2' value='3' min='0' step='0.5' />
          </label>
        </div>
        <div class='grid grid-cols-2 gap-4'>
          <label class='block'>
            <span class='text-sm text-slate-500'>Ad Spend / month ($)</span>
            <input id='adspend' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2' value='20000' min='0' step='100' />
          </label>
          <label class='block'>
            <span class='text-sm text-slate-500'>% Traffic Paid</span>
            <input id='paidshare' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2' value='60' min='0' step='1' />
          </label>
        </div>
        <div class='grid grid-cols-2 gap-4'>
          <label class='block'>
            <span class='text-sm text-slate-500'>Payment Fee %</span>
            <input id='fee' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2' value='2.9' min='0' step='0.1' />
          </label>
          <label class='block'>
            <span class='text-sm text-slate-500'>Shipping per Order ($)</span>
            <input id='shipping' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2' value='6' min='0' step='1' />
          </label>
        </div>
        <label class='block'>
          <span class='text-sm text-slate-500'>Fixed Costs / month ($)</span>
          <input id='fixed' type='number' class='mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2' value='15000' min='0' step='100' />
        </label>
      </div>
    </section>

    <!-- Scenario -->
    <section class='card p-6'>
      <h3 class='text-lg font-semibold'>2) Scenario Adjustments</h3>
      <div class='mt-4 space-y-4'>
        <div>
          <div class='flex items-center justify-between'><span class='text-sm text-slate-500'>Traffic Change %</span><span id='dTrafficVal' class='text-sm font-semibold'>0%</span></div>
          <input id='dTraffic' type='range' min='-50' max='200' value='0' class='w-full accent-[var(--cobalt)]'>
        </div>
        <div>
          <div class='flex items-center justify-between'><span class='text-sm text-slate-500'>CVR Change (abs. % pts)</span><span id='dCVRVal' class='text-sm font-semibold'>+1.0pt</span></div>
          <input id='dCVR' type='range' min='-2' max='10' value='1' step='0.1' class='w-full accent-[var(--cobalt)]'>
        </div>
        <div>
          <div class='flex items-center justify-between'><span class='text-sm text-slate-500'>AOV Change %</span><span id='dAOVVal' class='text-sm font-semibold'>+10%</span></div>
          <input id='dAOV' type='range' min='-30' max='100' value='10' class='w-full accent-[var(--cobalt)]'>
        </div>
        <div>
          <div class='flex items-center justify-between'><span class='text-sm text-slate-500'>Ad Spend Change %</span><span id='dAdVal' class='text-sm font-semibold'>0%</span></div>
          <input id='dAd' type='range' min='-50' max='200' value='0' class='w-full accent-[var(--cobalt)]'>
        </div>
        <p class='text-xs text-slate-500'>Tip: Use +1pt CVR with same traffic to see pure product-page lift on profit.</p>
      </div>
    </section>

    <!-- KPIs -->
    <section class='card p-6'>
      <h3 class='text-lg font-semibold'>3) KPIs (Monthly)</h3>
      <div class='mt-4 grid grid-cols-2 gap-4'>
        <div class='p-4 rounded-xl bg-white border border-black/5'>
          <div class='text-[11px] uppercase tracking-wide text-slate-500'>Contribution Profit</div>
          <div class='text-2xl font-extrabold' id='kpiProfit'>$0</div>
        </div>
        <div class='p-4 rounded-xl bg-white border border-black/5'>
          <div class='text-[11px] uppercase tracking-wide text-slate-500'>Revenue</div>
          <div class='text-2xl font-extrabold' id='kpiRevenue'>$0</div>
        </div>
        <div class='p-4 rounded-xl bg-white border border-black/5'>
          <div class='text-[11px] uppercase tracking-wide text-slate-500'>Orders</div>
          <div class='text-2xl font-extrabold' id='kpiOrders'>0</div>
        </div>
        <div class='p-4 rounded-xl bg-white border border-black/5'>
          <div class='text-[11px] uppercase tracking-wide text-slate-500'>Blended ROAS</div>
          <div class='text-2xl font-extrabold' id='kpiROAS'>0.00x</div>
        </div>
      </div>
      <div class='mt-3 text-sm text-slate-600' id='deltaNote'></div>
    </section>
  </div>

  <!-- Table + Chart -->
  <div class='grid grid-cols-1 xl:grid-cols-2 gap-6'>
    <section class='card p-6'>
      <h3 class='text-lg font-semibold'>Base vs Scenario (Monthly P&L)</h3>
      <div class='overflow-x-auto mt-3'>
        <table class='min-w-full text-sm'>
          <thead>
            <tr class='text-left text-slate-500 border-b border-black/5'>
              <th class='py-2 pr-4'>Metric</th>
              <th class='py-2 pr-4'>Base</th>
              <th class='py-2 pr-4'>Scenario</th>
              <th class='py-2 pr-4'>Δ Change</th>
            </tr>
          </thead>
          <tbody id='plTable' class='divide-y divide-black/5'></tbody>
        </table>
      </div>
    </section>
    <section class='card p-6'>
      <h3 class='text-lg font-semibold'>Profit vs CVR Improvement</h3>
      <canvas id='profitChart' height='160' class='mt-4'></canvas>
      <p class='text-xs text-slate-500 mt-3'>Projected contribution profit as CVR improves by absolute percentage points.</p>
    </section>
  </div>

  <section class='text-center text-xs text-slate-500 pt-2'>
    Contribution Profit = Revenue – COGS – Fees – Shipping – Ad Spend – Fixed Costs.
  </section>
</main>

<script>
const $ = (id)=>document.getElementById(id);

function fmt(n, opts={}) {
  const {money=false, perc=false} = opts;
  if (money) return n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0});
  if (perc) return (n).toFixed(1)+'%';
  return n.toLocaleString(undefined,{maximumFractionDigits:2});
}

function computeModel(p){
  const orders = p.sessions*(p.cvr/100);
  const netOrders = orders*(1-p.refund/100);
  const revenue = orders*p.aov;
  const netRevenue = netOrders*p.aov;
  const cogs = netRevenue*(1-p.gm/100);
  const fees = netRevenue*(p.fee/100);
  const shipping = netOrders*p.shipping;
  const roas = p.adspend>0 ? (netRevenue/p.adspend) : Infinity;
  const cac = orders>0 ? (p.adspend/orders) : 0;
  const contrib = netRevenue - cogs - fees - shipping - p.adspend - p.fixed;
  return {orders, netOrders, revenue, netRevenue, cogs, fees, shipping, contrib, roas, cac};
}

function read(){
  return {
    sessions:+$('sessions').value, cvr:+$('cvr').value, aov:+$('aov').value, gm:+$('gm').value, refund:+$('refund').value,
    adspend:+$('adspend').value, paidshare:+$('paidshare').value, fee:+$('fee').value, shipping:+$('shipping').value, fixed:+$('fixed').value,
    dTraffic:+$('dTraffic').value, dCVR:+$('dCVR').value, dAOV:+$('dAOV').value, dAd:+$('dAd').value
  };
}

let chart;

function update(){
  const v = read();
  const base = computeModel(v);
  const sessions2 = v.sessions*(1+v.dTraffic/100);
  const cvr2 = Math.max(0, v.cvr+v.dCVR);
  const aov2 = v.aov*(1+v.dAOV/100);
  const ad2 = v.adspend*(1+v.dAd/100);
  const scenario = computeModel({...v, sessions:sessions2, cvr:cvr2, aov:aov2, adspend:ad2});

  // KPIs
  $('kpiProfit').textContent = fmt(scenario.contrib,{money:true});
  $('kpiRevenue').textContent = fmt(scenario.netRevenue,{money:true});
  $('kpiOrders').textContent = fmt(scenario.netOrders);
  $('kpiROAS').textContent = scenario.roas===Infinity ? '∞' : fmt(scenario.roas)+'x';
  $('deltaNote').textContent = `Δ vs Base → Profit: ${fmt(scenario.contrib-base.contrib,{money:true})}, Revenue: ${fmt(scenario.netRevenue-base.netRevenue,{money:true})}, Orders: ${fmt(scenario.netOrders-base.netOrders)}`;

  // Hero
  $('heroDeltaProfit').textContent = fmt(scenario.contrib - base.contrib, {money:true});
  $('heroOrders').textContent = fmt(scenario.netOrders);

  // Table
  const rows = [
    ['Sessions', fmt(v.sessions), fmt(sessions2), fmt(sessions2 - v.sessions)],
    ['Conversion Rate', fmt(v.cvr,{perc:true}), fmt(cvr2,{perc:true}), (cvr2-v.cvr>=0?'+':'') + (cvr2 - v.cvr).toFixed(1) + 'pt'],
    ['Average Order Value', fmt(v.aov,{money:true}), fmt(aov2,{money:true}), fmt(aov2 - v.aov,{money:true})],
    ['Orders (after refunds)', fmt(base.netOrders), fmt(scenario.netOrders), fmt(scenario.netOrders - base.netOrders)],
    ['Net Revenue', fmt(base.netRevenue,{money:true}), fmt(scenario.netRevenue,{money:true}), fmt(scenario.netRevenue - base.netRevenue,{money:true})],
    ['COGS', fmt(base.cogs,{money:true}), fmt(scenario.cogs,{money:true}), fmt(scenario.cogs - base.cogs,{money:true})],
    ['Payment Fees', fmt(base.fees,{money:true}), fmt(scenario.fees,{money:true}), fmt(scenario.fees - base.fees,{money:true})],
    ['Shipping', fmt(base.shipping,{money:true}), fmt(scenario.shipping,{money:true}), fmt(scenario.shipping - base.shipping,{money:true})],
    ['Ad Spend', fmt(v.adspend,{money:true}), fmt(ad2,{money:true}), fmt(ad2 - v.adspend,{money:true})],
    ['Fixed Costs', fmt(v.fixed,{money:true}), fmt(v.fixed,{money:true}), fmt(0,{money:true})],
    ['Contribution Profit', fmt(base.contrib,{money:true}), fmt(scenario.contrib,{money:true}), fmt(scenario.contrib - base.contrib,{money:true})],
    ['Blended ROAS', base.roas===Infinity?'∞':fmt(base.roas)+'x', scenario.roas===Infinity?'∞':fmt(scenario.roas)+'x', '—'],
    ['CAC (approx)', base.orders?fmt(base.cac,{money:true}):'—', scenario.orders?fmt(scenario.cac,{money:true}):'—', '—']
  ];
  $('plTable').innerHTML = rows.map(r=>`<tr>
      <td class='py-2 pr-4 text-slate-700'>${r[0]}</td>
      <td class='py-2 pr-4'>${r[1]}</td>
      <td class='py-2 pr-4'>${r[2]}</td>
      <td class='py-2 pr-4 font-semibold'>${r[3]}</td>
    </tr>`).join('');

  // Chart
  const labels=[], data=[];
  for(let i=-2;i<=10;i+=0.5){
    labels.push((i>0?'+':'')+i.toFixed(1)+'pt');
    data.push(computeModel({...v, cvr:Math.max(0, v.cvr+i)}).contrib);
  }
  if(chart) chart.destroy();
  chart = new Chart($('profitChart'),{
    type:'line',
    data:{labels, datasets:[{label:'Contribution Profit', data, fill:false, tension:.25}]},
    options:{plugins:{legend:{display:false}, tooltip:{callbacks:{label:(ctx)=>' '+fmt(ctx.parsed.y,{money:true})}}},
             scales:{y:{ticks:{callback:(v)=>fmt(v,{money:true})}}}}
  });

  // Slider labels
  $('dTrafficVal').textContent = (v.dTraffic>=0?'+':'')+v.dTraffic+'%';
  $('dCVRVal').textContent = (v.dCVR>=0?'+':'')+Number(v.dCVR).toFixed(1)+'pt';
  $('dAOVVal').textContent = (v.dAOV>=0?'+':'')+v.dAOV+'%';
  $('dAdVal').textContent = (v.dAd>=0?'+':'')+v.dAd+'%';
}

function bindInputs(){
  const ids = ['sessions','cvr','aov','gm','refund','adspend','paidshare','fee','shipping','fixed','dTraffic','dCVR','dAOV','dAd'];
  ids.forEach(id=>document.getElementById(id).addEventListener('input', update));
}

async function exportPDF(){
  const area = document.getElementById('captureArea');
  const canvas = await html2canvas(area, {scale: 2, useCORS: true});
  const imgData = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p','mm','a4');
  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();
  // Fit to a single page
  let w = pageWidth, h = canvas.height * w / canvas.width;
  if (h > pageHeight - 20) { h = pageHeight - 20; w = canvas.width * h / canvas.height; }
  const x = (pageWidth - w)/2, y = 10;
  pdf.addImage(imgData, 'PNG', x, y, w, h);
  pdf.save('TryLab_Profit_Calculator.pdf');
}

window.addEventListener('DOMContentLoaded', ()=>{
  bindInputs();
  update();
  document.getElementById('saveBtn').addEventListener('click', exportPDF);
});
</script>
</body>
</html>
